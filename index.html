<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sign In • LinkTradeNetwork</title>
<style>
  :root {
    --bg: #0b0f17;
    --card: #f6f8fb;
    --ink: #0b1220;
    --line: #d8e0ea;
    --btn: #ea6a00;
    --btn-hover: #c35700;
    --ok: #22c55e;
    --err: #ef4444;
    --link: #3b82f6;
  }
  * { box-sizing: border-box; }
  html, body { height: 100%; margin: 0; }
  body {
    background: var(--bg);
    color: var(--ink);
    font-family: Inter, system-ui, Segoe UI, Roboto, Arial, sans-serif;
  }
  .wrap {
    min-height: 100dvh;
    display: grid;
    place-items: center;
    padding: 1rem;
  }
  .card {
    background: var(--card);
    border-radius: 1rem;
    padding: 2rem;
    max-width: 400px;
    width: 100%;
    box-shadow: 0 4px 12px rgba(0,0,0,.2);
  }
  h1 {
    text-align: center;
    margin-bottom: 1rem;
  }
  label { display: block; margin-top: 1rem; }
  input {
    width: 100%;
    padding: .6rem;
    border: 1px solid var(--line);
    border-radius: .5rem;
    font-size: 1rem;
  }
  button {
    margin-top: 1.5rem;
    width: 100%;
    background: var(--btn);
    color: white;
    border: none;
    border-radius: .5rem;
    padding: .8rem;
    font-size: 1rem;
    cursor: pointer;
  }
  button:hover { background: var(--btn-hover); }
  .msg {
    margin-top: 1rem;
    font-weight: 500;
    text-align: center;
  }
  .msg.ok { color: var(--ok); }
  .msg.err { color: var(--err); }
  .link {
    display: block;
    text-align: center;
    color: var(--link);
    margin-top: .5rem;
    cursor: pointer;
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" id="signup-card">
      <h1>Welcome to LinkTradeNetwork</h1>
      <label>First Name</label>
      <input type="text" id="firstName" placeholder="First Name" />

      <label>Last Name</label>
      <input type="text" id="lastName" placeholder="Last Name" />

      <label>Email</label>
      <input type="email" id="email" placeholder="Email" />

      <button id="signupBtn">Get One-Time Code</button>
      <p class="msg" id="signupMsg"></p>
    </div>

    <div class="card" id="otp-card" style="display:none">
      <h1>Check your Email</h1>
      <p>We've sent a one-time code to your inbox.</p>
      <label>Enter Code</label>
      <input type="text" id="otp" placeholder="6-digit code" maxlength="6" />

      <button id="verifyBtn">Verify Code</button>
      <button id="resendBtn" style="background:#555;margin-top:.5rem;">Resend Code</button>

      <p class="msg" id="otpMsg"></p>
    </div>
  </div>

<script>
const ENDPOINT_URL = "https://script.google.com/macros/s/AKfycbwZEsZ1IYeqPxPmhLxI5EhhEIImy5qeZwA4oOjRa7UQ3Ctr9CQhnarY7tfmgRSeUOIY/exec";

let currentEmail = "";
let currentFirstName = "";
let currentLastName = "";

// Helper to POST JSON
async function postJSON(data) {
  const r = await fetch(ENDPOINT_URL, {
    method: "POST",
    mode: "cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });
  return await r.json();
}

const signupBtn = document.getElementById("signupBtn");
const verifyBtn = document.getElementById("verifyBtn");
const resendBtn = document.getElementById("resendBtn");
const signupMsg = document.getElementById("signupMsg");
const otpMsg = document.getElementById("otpMsg");

signupBtn.onclick = async () => {
  const firstName = document.getElementById("firstName").value.trim();
  const lastName = document.getElementById("lastName").value.trim();
  const email = document.getElementById("email").value.trim();
  if (!email || !firstName || !lastName) {
    signupMsg.textContent = "Please fill all fields.";
    signupMsg.className = "msg err";
    return;
  }
  signupBtn.disabled = true;
  signupMsg.textContent = "Sending code...";
  signupMsg.className = "msg";

  try {
    const r = await postJSON({
      action: "signup",
      firstName,
      lastName,
      email,
      userAgent: navigator.userAgent
    });
    if (r.success) {
      signupMsg.textContent = "Code sent! Check your email.";
      signupMsg.className = "msg ok";
      document.getElementById("signup-card").style.display = "none";
      document.getElementById("otp-card").style.display = "block";
      currentEmail = email;
      currentFirstName = firstName;
      currentLastName = lastName;
    } else {
      signupMsg.textContent = r.error || "Error sending code.";
      signupMsg.className = "msg err";
    }
  } catch (e) {
    signupMsg.textContent = e.message;
    signupMsg.className = "msg err";
  }
  signupBtn.disabled = false;
};

verifyBtn.onclick = async () => {
  const otp = document.getElementById("otp").value.trim();
  if (!otp) {
    otpMsg.textContent = "Please enter your code.";
    otpMsg.className = "msg err";
    return;
  }
  verifyBtn.disabled = true;
  otpMsg.textContent = "Verifying...";
  otpMsg.className = "msg";

  try {
    const r = await postJSON({
      action: "verify",
      email: currentEmail,
      otp
    });
    if (r.success) {
      otpMsg.textContent = "Verified! Redirecting...";
      otpMsg.className = "msg ok";
      setTimeout(() => (window.location.href = "front.html"), 1000);
    } else {
      otpMsg.textContent = r.error || "Invalid code.";
      otpMsg.className = "msg err";
    }
  } catch (e) {
    otpMsg.textContent = e.message;
    otpMsg.className = "msg err";
  }
  verifyBtn.disabled = false;
};

// ✅ Fixed resend logic — backend expects "request-otp"
resendBtn.onclick = async () => {
  const fullName = `${currentFirstName} ${currentLastName}`;
  resendBtn.disabled = true;
  try {
    const r = await postJSON({
      action: "request-otp",
      email: currentEmail,
      name: fullName,
      userAgent: navigator.userAgent
    });
    otpMsg.textContent = r.success ? "New code sent!" : (r.error || "Resend failed.");
    otpMsg.className = "msg " + (r.success ? "ok" : "err");
  } catch (e) {
    otpMsg.textContent = e.message;
    otpMsg.className = "msg err";
  }
  setTimeout(() => (resendBtn.disabled = false), 3000);
};
</script>
</body>
</html>

