<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>LinkTradeNetwork • Skilled Trades</title>
<style>
:root{
  --bg:#f0f4f8;--ink:#293241;--muted:#5d7290;--line:#cfd9e6;--panel:#ffffff;--panel2:#f8fafc;
  --brand:#ea6a00;--brand2:#c35700;--accent:#3d5a80
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font-family:'Poppins',system-ui,Segoe UI,Roboto,Arial,sans-serif;line-height:1.5}

/* ===== TOPBAR ===== */
.topbar{background:var(--accent);border-bottom:1px solid var(--line);position:sticky;top:0;z-index:10;color:white}
.topbar-inner{max-width:1200px;margin:auto;padding:12px 16px;display:flex;align-items:center;gap:16px;justify-content:space-between;flex-wrap:wrap}
.logo{display:flex;align-items:center;gap:12px}
.logo-badge{width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,#ff7e00,#ffaa00);display:grid;place-items:center;color:white;font-weight:800;font-size:18px;box-shadow:0 2px 5px rgba(0,0,0,.2)}
.logo-text{font-size:18px;font-weight:700}

/* ===== MOBILE MENU ===== */
.mobile-menu-btn{display:none;background:none;border:none;color:white;cursor:pointer;padding:8px;width:44px;height:44px;align-items:center;justify-content:center}
.mobile-menu-btn svg{width:28px;height:28px}

.nav{display:flex;align-items:center;gap:8px}
.nav a,.btn{color:white;text-decoration:none;font-weight:600;padding:10px 18px;border-radius:8px;font-size:15px;transition:all .2s;white-space:nowrap}
.nav a:hover{background:rgba(255,255,255,.1)}
.btn{cursor:pointer;border:none;min-height:44px}
.btn-primary{background:var(--brand);color:white;font-weight:600}
.btn-primary:hover{background:var(--brand2);transform:translateY(-2px);box-shadow:0 2px 5px rgba(0,0,0,.1)}
.btn-secondary{background:rgba(255,255,255,.15);backdrop-filter:blur(10px)}
.btn-secondary:hover{background:rgba(255,255,255,.25)}

/* ===== SEARCH ===== */
.search-container{flex-grow:1;max-width:400px;margin:0 10px;position:relative;min-width:200px}
#ai-search-input{min-height:44px;font-size:16px}
#ai-search-input::placeholder{color:rgba(255,255,255,.85)}
#ai-results-container{z-index:9999 !important}

/* ===== MAIN LAYOUT ===== */
.shell{max-width:1200px;margin:auto;padding:20px;display:grid;gap:20px;grid-template-columns:300px 1fr 320px}

/* ===== CARDS ===== */
.card{background:var(--panel);border:1px solid var(--line);border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,.05);overflow:hidden;transition:transform .2s}
.card:hover{transform:translateY(-3px);box-shadow:0 6px 20px rgba(0,0,0,.08)}
.card .hd{padding:16px 20px;font-weight:700;border-bottom:1px solid var(--line);background:var(--panel2);font-size:16px;display:flex;justify-content:space-between;align-items:center}
.card .bd{padding:20px}

/* ===== PROFILE ===== */
.profile-image-container{position:relative;width:100%;height:180px;border-radius:12px;background:var(--panel2);margin-bottom:16px;display:flex;align-items:center;justify-content:center;border:2px dashed var(--line);color:var(--muted);overflow:hidden;cursor:pointer;transition:all .2s}
.profile-image-container:hover{border-color:var(--brand);background:rgba(234,106,0,.05)}
.profile-image-container img{width:100%;height:100%;object-fit:cover;border-radius:12px}
.profile-image-overlay{position:absolute;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;color:white;font-size:14px;font-weight:600}
.profile-image-container:hover .profile-image-overlay{display:flex}
.profile-placeholder-content{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px}
.profile-placeholder-content svg{width:40px;height:40px;margin-bottom:8px;opacity:.5}

.profile-info{text-align:center;margin:15px 0;padding:15px;background:var(--panel2);border-radius:8px}
.profile-name{font-weight:700;font-size:18px;margin-bottom:4px}
.profile-trade{color:var(--muted);font-size:14px;margin-bottom:8px}
.profile-location{color:var(--muted);font-size:13px;display:flex;align-items:center;justify-content:center;gap:4px}

.documents-list{margin-top:15px}
.document-item{display:flex;align-items:center;justify-content:space-between;padding:10px;background:var(--panel2);border-radius:6px;margin-bottom:8px;font-size:13px}
.document-item svg{width:16px;height:16px;margin-right:8px;opacity:.7}
.document-remove{color:var(--brand);cursor:pointer;font-weight:600;font-size:12px}
.document-remove:hover{text-decoration:underline}

.small{font-size:14px;color:var(--muted)}

/* ===== MODAL ===== */
.modal-backdrop{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:1000;align-items:center;justify-content:center;padding:20px}
.modal-backdrop.active{display:flex}
.modal{background:var(--panel);border-radius:12px;max-width:600px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 10px 40px rgba(0,0,0,.2)}
.modal-header{padding:20px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}
.modal-header h2{margin:0;font-size:20px}
.modal-close{background:none;border:none;font-size:28px;cursor:pointer;color:var(--muted);line-height:1;padding:0;width:32px;height:32px}
.modal-close:hover{color:var(--ink)}
.modal-body{padding:20px}
.modal-footer{padding:20px;border-top:1px solid var(--line);display:flex;gap:10px;justify-content:flex-end}

/* ===== FILTERS ===== */
.section-title{font-weight:700;margin-bottom:12px;font-size:16px;color:var(--accent)}
.filters{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px}
.fbtn{padding:10px 16px;border:1px solid var(--line);border-radius:999px;background:var(--panel);color:var(--muted);font-size:14px;cursor:pointer;transition:all .2s;font-weight:500;min-height:44px;display:inline-flex;align-items:center}
.fbtn:hover{border-color:var(--brand);color:var(--brand)}
.fbtn.active{background:var(--brand);color:white;border-color:var(--brand)}

/* ===== JOBS ===== */
.jobs-container{display:flex;flex-direction:column;gap:16px}
.job{padding:18px;border:1px solid var(--line);border-radius:12px;transition:all .2s;background:var(--panel)}
.job:hover{border-color:var(--brand);box-shadow:0 4px 12px rgba(0,0,0,.08)}
.job .title{font-weight:700;font-size:17px;margin-bottom:8px;line-height:1.3}
.job .meta{font-size:14px;color:var(--muted);display:flex;align-items:center;gap:8px;margin-bottom:10px;flex-wrap:wrap}
.meta-dot{display:inline-block;width:4px;height:4px;background:var(--muted);border-radius:50%}
.tags{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px}
.tag{background:var(--panel2);border:1px solid var(--line);border-radius:6px;padding:6px 12px;font-size:13px;font-weight:500;color:var(--accent)}
.apply{display:flex;gap:10px;flex-wrap:wrap}
.featured{background:#fff9e6;border-left:4px solid #ffc107}

/* ===== FORMS ===== */
.upload-area{border:2px dashed var(--line);border-radius:8px;padding:20px;text-align:center;cursor:pointer;margin-bottom:20px;transition:all .2s;min-height:120px;display:flex;flex-direction:column;justify-content:center}
.upload-area:hover{border-color:var(--brand);background:rgba(234,106,0,.05)}
.upload-icon{display:block;width:40px;height:40px;margin:0 auto 10px;opacity:.5}
.form-group{margin-bottom:15px}
.form-group label{display:block;margin-bottom:5px;font-weight:500;font-size:15px}
.form-control{width:100%;padding:12px 14px;border:1px solid var(--line);border-radius:8px;background:var(--panel);font-family:inherit;font-size:16px;color:var(--ink);min-height:44px}
.form-control:focus{outline:none;border-color:var(--brand);box-shadow:0 0 0 2px rgba(234,106,0,.1)}
textarea.form-control{min-height:100px;resize:vertical}
select.form-control{cursor:pointer}

/* ===== BADGES & STATS ===== */
.badge{display:inline-block;padding:4px 10px;font-size:12px;font-weight:600;border-radius:999px;background:#e6f5eb;color:#2a9d51}
.badge-warning{background:#fff9e6;color:#b37400}
.stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin:15px 0}
.stat-card{background:var(--panel2);border:1px solid var(--line);border-radius:8px;padding:14px;text-align:center}
.stat-number{font-size:24px;font-weight:700;color:var(--accent)}
.stat-label{font-size:13px;color:var(--muted)}

/* ===== AI SEARCH ===== */
.ai-results{padding:12px;color:var(--ink)}
.ai-thinking{display:flex;align-items:center;gap:8px;padding:10px;color:var(--muted)}
.ai-thinking-dots{display:flex}
.ai-thinking-dots span{width:6px;height:6px;margin:0 2px;background:var(--brand);border-radius:50%;animation:ai-thinking 1.4s infinite ease-in-out both}
.ai-thinking-dots span:nth-child(1){animation-delay:-.32s}
.ai-thinking-dots span:nth-child(2){animation-delay:-.16s}
@keyframes ai-thinking{0%,80%,100%{transform:scale(0)}40%{transform:scale(1.0)}}
.ai-result{padding:12px;border-bottom:1px solid var(--line)}
.ai-result:last-child{border-bottom:none}
.ai-result-title{font-weight:600;margin-bottom:4px}

/* ===== SPONSORS ===== */
.sponsors-grid{display:grid;grid-template-columns:1fr;gap:12px}
.sponsor-card{background:var(--panel2);border:1px solid var(--line);border-radius:8px;padding:16px;display:flex;flex-direction:column;align-items:center;text-align:center;transition:all .2s;text-decoration:none;color:var(--ink)}
.sponsor-card:hover{border-color:var(--brand);box-shadow:0 2px 8px rgba(0,0,0,.08);transform:translateY(-2px)}
.sponsor-logo{max-width:120px;max-height:50px;object-fit:contain;margin-bottom:10px}
.sponsor-placeholder{width:100%;padding:20px;border:2px dashed var(--line);border-radius:6px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:15px;font-weight:600;margin-bottom:10px;background:var(--panel)}
.sponsor-description{font-size:13px;color:var(--muted);margin:0;line-height:1.4}
.sponsor-featured{background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none}
.sponsor-featured .sponsor-description{color:rgba(255,255,255,.9)}
.sponsor-featured .sponsor-placeholder{border-color:rgba(255,255,255,.3);color:white;background:rgba(255,255,255,.1)}

/* ===== RESPONSIVE BREAKPOINTS ===== */
@media(max-width:1100px){
  .shell{grid-template-columns:1fr 1fr;gap:16px}
  .right-sidebar{grid-column:span 2}
}

@media(max-width:768px){
  .topbar-inner{padding:10px 12px}
  .logo-text{font-size:16px}
  .logo-badge{width:38px;height:38px;font-size:16px}
  
  .mobile-menu-btn{display:flex}
  .nav{position:fixed;top:62px;left:0;right:0;background:var(--accent);flex-direction:column;align-items:stretch;padding:12px;gap:8px;transform:translateX(-100%);transition:transform .3s;box-shadow:0 4px 15px rgba(0,0,0,.2);max-height:calc(100vh - 62px);overflow-y:auto}
  .nav.open{transform:translateX(0)}
  .nav a,.nav .btn{width:100%;text-align:center;justify-content:center;padding:14px 18px}
  
  .search-container{width:100%;max-width:none;margin:10px 0 0 0;order:3;flex-basis:100%}
  
  .shell{grid-template-columns:1fr;padding:12px;gap:16px}
  .right-sidebar{grid-column:span 1}
  
  .card .bd{padding:16px}
  .card .hd{padding:14px 16px;font-size:15px}
  
  .modal{margin:10px}
  .modal-body{padding:16px}
  
  .job{padding:16px}
  .job .title{font-size:16px}
  .job .meta{font-size:13px}
  
  .form-control{font-size:16px;padding:12px}
  .fbtn{font-size:13px;padding:8px 14px;min-height:40px}
  
  .stats{gap:8px}
  .stat-card{padding:12px}
  .stat-number{font-size:20px}
}

@media(max-width:480px){
  .topbar-inner{padding:8px 10px;gap:8px}
  .logo-text{font-size:14px}
  .logo-badge{width:36px;height:36px;font-size:14px}
  
  .shell{padding:10px;gap:12px}
  
  .card .bd{padding:14px}
  .card .hd{padding:12px 14px;font-size:14px;flex-direction:column;align-items:flex-start;gap:8px}
  
  .modal-header h2{font-size:18px}
  .modal-body{padding:14px}
  
  .job{padding:14px}
  .job .title{font-size:15px}
  .job .meta{font-size:12px;gap:6px}
  .meta-dot{width:3px;height:3px}
  .tags{gap:4px}
  .tag{padding:5px 10px;font-size:12px}
  .apply{gap:8px}
  .apply button, .apply a{font-size:14px;padding:10px 16px}
  
  .filters{gap:6px}
  .fbtn{font-size:12px;padding:8px 12px;min-height:38px}
  
  .form-group label{font-size:14px}
  .form-control{font-size:16px;padding:10px 12px}
  
  .stats{grid-template-columns:1fr 1fr;gap:6px}
  .stat-card{padding:10px}
  .stat-number{font-size:18px}
  .stat-label{font-size:12px}
  
  .profile-image-container{height:150px}
  .upload-area{padding:16px;min-height:100px}
  
  .sponsor-card{padding:14px}
  .sponsor-logo{max-width:100px;max-height:40px}
  
  .small{font-size:13px}
  
  button, .btn{font-size:15px;padding:10px 16px}
}

@media(max-width:360px){
  .logo-text{display:none}
  
  .job .title{font-size:14px}
  .job .meta{font-size:11px}
  
  .apply{flex-direction:column}
  .apply button, .apply a{width:100%}
  
  .stats{grid-template-columns:1fr}
  
  .fbtn{font-size:11px;padding:6px 10px;min-height:36px}
}

@media(max-height:500px) and (orientation:landscape){
  .nav{max-height:calc(100vh - 52px)}
  .topbar-inner{padding:6px 12px}
  .logo-badge{width:34px;height:34px}
}
</style>
</head>
<body>

<header class="topbar">
  <div class="topbar-inner">
    <div class="logo">
      <div class="logo-badge">LTN</div>
      <div class="logo-text">LinkTradeNetwork</div>
    </div>

    <button class="mobile-menu-btn" id="mobile-menu-toggle" aria-label="Toggle menu">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </button>

    <div class="search-container">
      <div class="ai-search-wrapper" style="position:relative;">
        <input type="text" id="ai-search-input" class="form-control" placeholder="Ask LTN AI anything..." style="background:rgba(255,255,255,.15);border:none;color:white;padding-left:35px">
        <svg id="ai-icon" style="position:absolute;left:10px;top:12px;width:18px;height:18px;opacity:.8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="white"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>
        <div class="ai-label" style="position:absolute;right:8px;top:12px;font-size:10px;background:var(--brand);color:white;padding:1px 6px;border-radius:10px;opacity:.9;font-weight:600">LTN AI</div>
      </div>
      <div id="ai-results-container" class="ai-results" style="display:none;position:absolute;top:50px;left:0;right:0;background:white;border-radius:8px;box-shadow:0 4px 15px rgba(0,0,0,.15);z-index:100;max-height:400px;overflow-y:auto"></div>
    </div>

    <nav class="nav" id="main-nav">
      <a href="#">Home</a>
      <a href="#">Jobs</a>
      <a href="#">Network</a>
      <a href="#">Messages</a>
      <button class="btn btn-primary">Post a Job</button>
      <a href="index.html" class="btn btn-secondary">Logout</a>
    </nav>
  </div>
</header>

<main class="shell">
  <!-- LEFT -->
  <aside>
    <section class="card">
      <div class="hd"><span>Profile</span><span class="badge">Professional</span></div>
      <div class="bd">
        <!-- Profile Image -->
        <div class="profile-image-container" id="profile-image-area">
          <div class="profile-placeholder-content">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
            <div>Click to add profile image</div>
          </div>
          <div class="profile-image-overlay">Change Photo</div>
        </div>
        <input type="file" id="profile-image-input" accept="image/*" style="display:none">

        <!-- Profile Info -->
        <div class="profile-info" id="profile-info-display">
          <div class="profile-name" id="display-name">Your Name</div>
          <div class="profile-trade" id="display-trade">Your Trade</div>
          <div class="profile-location">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 13c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3Z"/><path d="M19 10c0 4.418-7 10-7 10S5 14.418 5 10a7 7 0 1 1 14 0Z"/></svg>
            <span id="display-location">Your Location</span>
          </div>
        </div>

        <!-- Documents List -->
        <div class="documents-list" id="documents-list"></div>

        <!-- Upload Documents -->
        <div class="upload-area" id="profile-upload">
          <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0l-4 4m4-4v12"/></svg>
          <div class="small">Click to upload documents</div>
          <div class="small">(Resume, certifications, licenses)</div>
          <input type="file" id="file-upload" style="display:none" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
        </div>

        <div class="stats">
          <div class="stat-card"><div class="stat-number" id="connections-count">24</div><div class="stat-label">Connections</div></div>
          <div class="stat-card"><div class="stat-number" id="applications-count">8</div><div class="stat-label">Applications</div></div>
        </div>

        <p class="small">Complete your profile to improve visibility with contractors and employers.</p>
        <button class="btn-primary" id="edit-profile-btn" style="width:100%;margin-top:10px">Edit Profile</button>
      </div>
    </section>

    <section class="card" style="margin-top:20px">
      <div class="hd">Job Alerts</div>
      <div class="bd">
        <p class="small">Get notified when new jobs match your skills.</p>
        <div class="form-group"><label>Skills & Trades</label><input type="text" class="form-control" placeholder="e.g. Electrical, Low Voltage"></div>
        <div class="form-group"><label>Location</label><input type="text" class="form-control" placeholder="City, State, or Zip"></div>
        <button class="btn-primary" style="width:100%">Create Alert</button>
      </div>
    </section>
  </aside>

  <!-- MIDDLE -->
  <section>
    <div class="card">
      <div class="hd"><span>Skilled Trade Opportunities</span><span class="badge badge-warning">12 new today</span></div>
      <div class="bd">
        <div class="filters" id="jobs-filter-bar">
          <button class="fbtn active">All</button>
          <button class="fbtn">Low Voltage</button>
          <button class="fbtn">Electrical</button>
          <button class="fbtn">Plumbing</button>
          <button class="fbtn">HVAC</button>
          <button class="fbtn">General Contractor</button>
          <button class="fbtn">Physical Security</button>
          <button class="fbtn">Sprinkler</button>
        </div>

        <div id="jobs-list" class="jobs-container"></div>
        <div id="jobs-empty" class="small" style="display:none;color:var(--muted);padding:8px 4px">
          No jobs found. Try another trade, keyword, or location.
        </div>
        <div style="display:flex;gap:8px;margin-top:10px;flex-wrap:wrap">
          <button id="jobs-prev" class="btn btn-secondary" disabled>Prev</button>
          <button id="jobs-next" class="btn btn-secondary" disabled>Next</button>
          <div class="small" id="jobs-count" style="margin-left:auto;color:var(--muted);align-self:center"></div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:24px">
      <div class="hd">Success Stories</div>
      <div class="bd">
        <div style="display:flex;align-items:center;margin-bottom:20px;padding-bottom:20px;border-bottom:1px solid var(--line);flex-wrap:wrap;gap:15px">
          <div style="width:80px;height:80px;background:var(--panel2);border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center">
            <svg style="width:40px;height:40px;opacity:.5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
          </div>
          <div style="flex:1;min-width:200px">
            <div style="font-weight:700;font-size:16px">Michael Rodriguez - Electrician</div>
            <div style="color:var(--muted);margin-bottom:5px">Milwaukee, WI</div>
            <p style="margin:0">"I found my current position through LinkTradeNetwork within 2 weeks of creating my profile. The job pays 20% more than my previous position and has better hours."</p>
          </div>
        </div>
        <button class="btn-primary" style="width:100%;margin-top:20px">Share Your Success Story</button>
      </div>
    </div>

    <div class="card" style="margin-top:24px">
      <div class="hd">Post a New Job</div>
      <div class="bd">
        <div class="form-group"><label>Job Title</label><input type="text" class="form-control" placeholder="e.g. Experienced Plumber for Commercial Project"></div>
        <div class="form-group"><label>Job Type</label><select class="form-control"><option>Full-time</option><option>Contract</option><option>Part-time</option><option>Project-based</option></select></div>
        <div class="form-group"><label>Location</label><input type="text" class="form-control" placeholder="City, State"></div>
        <div class="form-group"><label>Pay Range</label><div style="display:flex;gap:10px;flex-wrap:wrap"><input type="text" class="form-control" placeholder="Min $" style="flex:1;min-width:100px"><input type="text" class="form-control" placeholder="Max $" style="flex:1;min-width:100px"><select class="form-control" style="flex:1;min-width:100px"><option>hourly</option><option>daily</option><option>project</option></select></div></div>
        <div class="form-group"><label>Required Skills</label><div class="filters" style="margin-top:5px"><button class="fbtn">Low Voltage</button><button class="fbtn">Electrical</button><button class="fbtn">Plumbing</button><button class="fbtn">HVAC</button><button class="fbtn">General Contractor</button><button class="fbtn">Physical Security</button></div></div>
        <div class="form-group"><label>Job Description</label><textarea class="form-control" placeholder="Describe the job..."></textarea></div>
        <div class="form-group"><label>Upload Supporting Documents (optional)</label><div class="upload-area"><svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg><div class="small">Drag and drop or click to upload</div></div></div>
        <button class="btn-primary" style="width:100%">Post Job</button>
      </div>
    </div>
  </section>

  <!-- RIGHT -->
  <aside class="right-sidebar">
    <section class="card">
      <div class="hd">Our Sponsors</div>
      <div class="bd">
        <div id="sponsors-container" class="sponsors-grid">
          <div class="small" style="text-align:center;padding:20px;color:var(--muted)">Loading sponsors...</div>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:20px">
      <div class="hd">Get Connected</div>
      <div class="bd small">
        <p>Join the network built for skilled trades professionals:</p>
        <ul style="margin:0 0 15px 18px;padding:0"><li style="margin-bottom:8px">Find verified trade jobs with competitive pay</li><li style="margin-bottom:8px">Connect with local contractors and employers</li><li style="margin-bottom:8px">Showcase your skills and certifications</li><li>Get matched with projects in your area</li></ul>
        <button class="btn-primary" style="width:100%">Join Network</button>
      </div>
    </section>

    <section class="card" style="margin-top:20px">
      <div class="hd">Get The LTN Mobile App</div>
      <div class="bd" style="padding:0">
        <div style="background:linear-gradient(135deg,var(--brand),var(--brand2));color:white;padding:20px;text-align:center;border-radius:0 0 12px 12px">
          <svg style="width:60px;height:60px;margin-bottom:10px" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="white"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 01-2 2z"/></svg>
          <h3 style="margin:0 0 10px;font-size:18px">Find Trade Jobs On The Go</h3>
          <p style="margin:0 0 15px;font-size:14px">Get instant job alerts, apply with one tap, and chat with employers directly from your phone.</p>
          <button class="btn-secondary" style="display:inline-block;padding:12px 24px;font-size:16px">Get The LTN App</button>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:20px">
      <div class="hd">Upcoming Events</div>
      <div class="bd small">
        <div style="margin-bottom:15px"><div style="font-weight:600">Trade Skills Workshop</div><div style="font-size:13px">November 15, 2025 • 9:00 AM</div><div style="color:var(--muted);font-size:13px">Milwaukee Convention Center</div></div>
        <div style="margin-bottom:15px"><div style="font-weight:600">Electrical Code Updates</div><div style="font-size:13px">November 22, 2025 • 1:00 PM</div><div style="color:var(--muted);font-size:13px">Online Webinar</div></div>
        <div><div style="font-weight:600">Contractor Networking Mixer</div><div style="font-size:13px">December 5, 2025 • 6:00 PM</div><div style="color:var(--muted);font-size:13px">Madison Trade Association</div></div>
        <button class="btn-primary" style="width:100%;margin-top:15px">View All Events</button>
      </div>
    </section>

    <section class="card" style="margin-top:20px">
      <div class="hd">Quick Resources</div>
      <div class="bd small">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
          <a href="#" style="text-decoration:none"><div style="border:1px solid var(--line);border-radius:8px;padding:12px;text-align:center;color:var(--ink);min-height:80px;display:flex;flex-direction:column;justify-content:center"><svg style="width:24px;height:24px;margin:0 auto 8px;display:block;opacity:.7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h2l2-2 4-4M7 20h10a2 2 0 002-2V6a2 2 0 00-2-2H7a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><div>License Info</div></div></a>
          <a href="#" style="text-decoration:none"><div style="border:1px solid var(--line);border-radius:8px;padding:12px;text-align:center;color:var(--ink);min-height:80px;display:flex;flex-direction:column;justify-content:center"><svg style="width:24px;height:24px;margin:0 auto 8px;display:block;opacity:.7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg><div>Training</div></div></a>
          <a href="#" style="text-decoration:none"><div style="border:1px solid var(--line);border-radius:8px;padding:12px;text-align:center;color:var(--ink);min-height:80px;display:flex;flex-direction:column;justify-content:center"><svg style="width:24px;height:24px;margin:0 auto 8px;display:block;opacity:.7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><div>Certifications</div></div></a>
          <a href="#" style="text-decoration:none"><div style="border:1px solid var(--line);border-radius:8px;padding:12px;text-align:center;color:var(--ink);min-height:80px;display:flex;flex-direction:column;justify-content:center"><svg style="width:24px;height:24px;margin:0 auto 8px;display:block;opacity:.7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9"/></svg><div>Support</div></div></a>
        </div>
      </div>
    </section>
  </aside>
</main>

<!-- Edit Profile Modal -->
<div class="modal-backdrop" id="profile-modal">
  <div class="modal">
    <div class="modal-header">
      <h2>Edit Profile</h2>
      <button class="modal-close" id="close-modal">&times;</button>
    </div>
    <div class="modal-body">
      <form id="profile-form">
        <div class="form-group">
          <label>Full Name *</label>
          <input type="text" id="input-name" class="form-control" placeholder="John Smith" required>
        </div>
        
        <div class="form-group">
          <label>Email Address *</label>
          <input type="email" id="input-email" class="form-control" placeholder="john@example.com" required>
        </div>
        
        <div class="form-group">
          <label>Phone Number</label>
          <input type="tel" id="input-phone" class="form-control" placeholder="(555) 123-4567">
        </div>
        
        <div class="form-group">
          <label>Trade / Specialty *</label>
          <select id="input-trade" class="form-control" required>
            <option value="">Select your trade</option>
            <option value="Electrical">Electrical</option>
            <option value="Low Voltage">Low Voltage</option>
            <option value="Plumbing">Plumbing</option>
            <option value="HVAC">HVAC</option>
            <option value="General Contractor">General Contractor</option>
            <option value="Physical Security">Physical Security</option>
            <option value="Sprinkler Systems">Sprinkler Systems</option>
            <option value="Carpentry">Carpentry</option>
            <option value="Welding">Welding</option>
            <option value="Other">Other</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Years of Experience</label>
          <input type="number" id="input-experience" class="form-control" placeholder="5" min="0" max="50">
        </div>
        
        <div class="form-group">
          <label>City *</label>
          <input type="text" id="input-city" class="form-control" placeholder="Milwaukee" required>
        </div>
        
        <div class="form-group">
          <label>State *</label>
          <select id="input-state" class="form-control" required>
            <option value="">Select state</option>
            <option value="WI">Wisconsin</option>
            <option value="IL">Illinois</option>
            <option value="MN">Minnesota</option>
            <option value="MI">Michigan</option>
            <option value="IA">Iowa</option>
            <option value="IN">Indiana</option>
            <option value="OH">Ohio</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>About / Bio</label>
          <textarea id="input-bio" class="form-control" placeholder="Tell employers about your skills, experience, and what you're looking for..."></textarea>
        </div>
        
        <div class="form-group">
          <label>Skills (comma separated)</label>
          <input type="text" id="input-skills" class="form-control" placeholder="Wiring, Code Compliance, Blueprint Reading">
        </div>
        
        <div class="form-group">
          <label>Certifications / Licenses</label>
          <textarea id="input-certifications" class="form-control" placeholder="Master Electrician License - State of WI&#10;OSHA 30-Hour Construction"></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" id="cancel-modal">Cancel</button>
      <button class="btn btn-primary" id="save-profile">Save Profile</button>
    </div>
  </div>
</div>

<script>
/* ===== CONFIG ===== */
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxPC75k0PVGULCWNkABK2Cc7uSo3xcAdven3r8KBrTyEeVdJBHuhDZvMLp6ciyenxi2_A/exec";

/* ===== Utility ===== */
function debounce(fn, ms){let t;return (...a)=>{clearTimeout(t);t=setTimeout(()=>fn.apply(this,a),ms)}}
const isHtmlResponse = (res) => {
  const ct = res.headers.get('content-type') || '';
  return ct.includes('text/html');
};

/* ===== PROFILE MANAGEMENT ===== */
const ProfileManager = {
  init() {
    this.loadProfile();
    this.loadDocuments();
    this.bindEvents();
  },

  bindEvents() {
    // Profile image upload
    document.getElementById('profile-image-area').addEventListener('click', () => {
      document.getElementById('profile-image-input').click();
    });
    
    document.getElementById('profile-image-input').addEventListener('change', (e) => {
      this.handleImageUpload(e.target.files[0]);
    });

    // Document upload
    document.getElementById('profile-upload').addEventListener('click', () => {
      document.getElementById('file-upload').click();
    });
    
    document.getElementById('file-upload').addEventListener('change', (e) => {
      this.handleDocumentUpload(e.target.files);
    });

    // Edit profile modal
    document.getElementById('edit-profile-btn').addEventListener('click', () => {
      this.openModal();
    });
    
    document.getElementById('close-modal').addEventListener('click', () => {
      this.closeModal();
    });
    
    document.getElementById('cancel-modal').addEventListener('click', () => {
      this.closeModal();
    });
    
    document.getElementById('save-profile').addEventListener('click', () => {
      this.saveProfile();
    });

    // Close modal on backdrop click
    document.getElementById('profile-modal').addEventListener('click', (e) => {
      if (e.target.id === 'profile-modal') {
        this.closeModal();
      }
    });
  },

  async handleImageUpload(file) {
    if (!file) return;
    
    if (!file.type.startsWith('image/')) {
      alert('Please select an image file');
      return;
    }

    const reader = new FileReader();
    reader.onload = async (e) => {
      const imageData = e.target.result;
      const email = localStorage.getItem('userEmail');
      
      if (!email) {
        // Fallback to localStorage if not signed in
        localStorage.setItem('profileImage', imageData);
        this.displayProfileImage(imageData);
        return;
      }

      try {
        // Upload to backend
        const res = await fetch(WEBAPP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain;charset=utf-8' },
          body: JSON.stringify({
            action: 'upload-image',
            email: email,
            imageData: imageData,
            fileName: file.name
          })
        });

        const data = await res.json();
        if (data.success) {
          this.displayProfileImage(imageData);
          alert('Profile image uploaded successfully!');
        } else {
          alert('Failed to upload image: ' + (data.error || 'Unknown error'));
        }
      } catch (error) {
        console.error('Upload error:', error);
        alert('Failed to upload image. Please try again.');
      }
    };
    reader.readAsDataURL(file);
  },

  displayProfileImage(imageData) {
    const container = document.getElementById('profile-image-area');
    container.innerHTML = `
      <img src="${imageData}" alt="Profile">
      <div class="profile-image-overlay">Change Photo</div>
    `;
  },

  handleDocumentUpload(files) {
    if (!files || files.length === 0) return;

    // For now, store in localStorage (you can enhance this to upload to Drive later)
    const documents = JSON.parse(localStorage.getItem('profileDocuments') || '[]');
    
    Array.from(files).forEach(file => {
      const doc = {
        id: Date.now() + Math.random(),
        name: file.name,
        size: file.size,
        type: file.type,
        uploadedAt: new Date().toISOString()
      };
      documents.push(doc);
    });

    localStorage.setItem('profileDocuments', JSON.stringify(documents));
    this.displayDocuments();
  },

  displayDocuments() {
    const documents = JSON.parse(localStorage.getItem('profileDocuments') || '[]');
    const container = document.getElementById('documents-list');

    if (documents.length === 0) {
      container.innerHTML = '';
      return;
    }

    container.innerHTML = `
      <div style="font-weight:600;font-size:13px;margin-bottom:8px;color:var(--accent)">Uploaded Documents</div>
      ${documents.map(doc => `
        <div class="document-item">
          <div style="display:flex;align-items:center;flex:1">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            <span style="flex:1">${doc.name}</span>
          </div>
          <span class="document-remove" onclick="ProfileManager.removeDocument('${doc.id}')">Remove</span>
        </div>
      `).join('')}
    `;
  },

  removeDocument(id) {
    const documents = JSON.parse(localStorage.getItem('profileDocuments') || '[]');
    const filtered = documents.filter(doc => doc.id != id);
    localStorage.setItem('profileDocuments', JSON.stringify(filtered));
    this.displayDocuments();
  },

  async openModal() {
    const email = localStorage.getItem('userEmail');
    
    if (!email) {
      // Fallback to localStorage
      const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
      this.populateForm(profile);
      document.getElementById('profile-modal').classList.add('active');
      return;
    }

    try {
      // Load from backend
      const res = await fetch(WEBAPP_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
        body: JSON.stringify({ action: 'get-profile', email: email })
      });

      const data = await res.json();
      if (data.success && data.profile) {
        this.populateForm(data.profile);
      } else {
        // New profile - pre-fill email
        document.getElementById('input-email').value = email;
      }
    } catch (error) {
      console.error('Load profile error:', error);
    }
    
    document.getElementById('profile-modal').classList.add('active');
  },

  populateForm(profile) {
    document.getElementById('input-name').value = profile.fullName || profile.name || '';
    document.getElementById('input-email').value = profile.email || '';
    document.getElementById('input-phone').value = profile.phone || '';
    document.getElementById('input-trade').value = profile.trade || '';
    document.getElementById('input-experience').value = profile.experience || '';
    document.getElementById('input-city').value = profile.city || '';
    document.getElementById('input-state').value = profile.state || '';
    document.getElementById('input-bio').value = profile.bio || '';
    document.getElementById('input-skills').value = profile.skills || '';
    document.getElementById('input-certifications').value = profile.certifications || '';
  },

  closeModal() {
    document.getElementById('profile-modal').classList.remove('active');
  },

  async saveProfile() {
    const email = document.getElementById('input-email').value.trim();
    
    if (!email) {
      alert('Email is required');
      return;
    }

    const profile = {
      email: email,
      fullName: document.getElementById('input-name').value.trim(),
      phone: document.getElementById('input-phone').value.trim(),
      trade: document.getElementById('input-trade').value,
      experience: document.getElementById('input-experience').value,
      city: document.getElementById('input-city').value.trim(),
      state: document.getElementById('input-state').value,
      bio: document.getElementById('input-bio').value.trim(),
      skills: document.getElementById('input-skills').value.trim(),
      certifications: document.getElementById('input-certifications').value.trim()
    };

    if (!profile.fullName || !profile.trade || !profile.city || !profile.state) {
      alert('Please fill in all required fields (marked with *)');
      return;
    }

    try {
      // Save to backend
      const res = await fetch(WEBAPP_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
        body: JSON.stringify({ action: 'save-profile', ...profile })
      });

      const data = await res.json();
      
      if (data.success) {
        // Store email for future use
        localStorage.setItem('userEmail', email);
        
        this.displayProfile(profile);
        this.closeModal();
        alert('Profile saved successfully!');
      } else {
        alert('Failed to save profile: ' + (data.error || 'Unknown error'));
      }
    } catch (error) {
      console.error('Save profile error:', error);
      alert('Failed to save profile. Please try again.');
    }
  },

  async loadProfile() {
    const email = localStorage.getItem('userEmail');
    
    if (!email) {
      // Try localStorage fallback
      const profile = JSON.parse(localStorage.getItem('userProfile') || '{}');
      this.displayProfile(profile);
      return;
    }

    try {
      const res = await fetch(WEBAPP_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
        body: JSON.stringify({ action: 'get-profile', email: email })
      });

      const data = await res.json();
      
      if (data.success && data.profile) {
        this.displayProfile(data.profile);
        
        // Load profile image if exists
        if (data.profile.profileImageUrl) {
          this.displayProfileImage(data.profile.profileImageUrl);
        }
      }
    } catch (error) {
      console.error('Load profile error:', error);
    }
  },

  loadDocuments() {
    this.displayDocuments();
  },

  displayProfile(profile) {
    if (!profile) profile = {};
    
    document.getElementById('display-name').textContent = profile.fullName || profile.name || 'Your Name';
    document.getElementById('display-trade').textContent = profile.trade 
      ? (profile.experience ? `${profile.trade} • ${profile.experience} years` : profile.trade)
      : 'Your Trade';
    document.getElementById('display-location').textContent = 
      (profile.city && profile.state) 
        ? `${profile.city}, ${profile.state}` 
        : 'Your Location';
  }
};

/* ===== MOBILE MENU TOGGLE ===== */
document.getElementById('mobile-menu-toggle').addEventListener('click', function() {
  const nav = document.getElementById('main-nav');
  nav.classList.toggle('open');
  
  const icon = this.querySelector('svg');
  if (nav.classList.contains('open')) {
    icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>';
  } else {
    icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>';
  }
});

document.addEventListener('click', function(e) {
  const nav = document.getElementById('main-nav');
  const toggle = document.getElementById('mobile-menu-toggle');
  if (nav.classList.contains('open') && !nav.contains(e.target) && !toggle.contains(e.target)) {
    nav.classList.remove('open');
    toggle.querySelector('svg').innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>';
  }
});

document.querySelectorAll('.nav a, .nav button').forEach(item => {
  item.addEventListener('click', function() {
    const nav = document.getElementById('main-nav');
    const toggle = document.getElementById('mobile-menu-toggle');
    if (window.innerWidth <= 768) {
      nav.classList.remove('open');
      toggle.querySelector('svg').innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>';
    }
  });
});

/* ===== Load Sponsors ===== */
async function loadSponsors() {
  const container = document.getElementById('sponsors-container');
  
  try {
    const res = await fetch(WEBAPP_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify({ action: 'get-sponsors' })
    });

    if (!res.ok) throw new Error('Failed to load sponsors');
    
    const data = await res.json();
    
    if (!data.success || !data.sponsors || data.sponsors.length === 0) {
      container.innerHTML = '<div class="small" style="text-align:center;padding:20px;color:var(--muted)">No sponsors yet.</div>';
      return;
    }

    container.innerHTML = data.sponsors.map((sponsor, index) => {
      const isFeatured = index === 0;
      const cardClass = isFeatured ? 'sponsor-card sponsor-featured' : 'sponsor-card';
      
      return `
        <a href="${sponsor.link}" target="_blank" rel="noopener noreferrer" class="${cardClass}">
          ${sponsor.logoUrl 
            ? `<img src="${sponsor.logoUrl}" alt="${sponsor.name}" class="sponsor-logo">`
            : `<div class="sponsor-placeholder">${sponsor.name}</div>`
          }
          <p class="sponsor-description">${sponsor.description}</p>
        </a>
      `;
    }).join('');

  } catch (error) {
    console.error('Error loading sponsors:', error);
    container.innerHTML = '<div class="small" style="text-align:center;padding:20px;color:var(--muted)">Unable to load sponsors.</div>';
  }
}

/* ===== Filter buttons behavior ===== */
document.addEventListener('DOMContentLoaded', function() {
  // Initialize profile manager
  ProfileManager.init();

  const filterGroups = document.querySelectorAll('.filters');
  filterGroups.forEach(group => {
    const buttons = group.querySelectorAll('.fbtn');
    buttons.forEach(b => b.addEventListener('click', () => {
      if (!group.parentElement.classList.contains('form-group')) {
        buttons.forEach(x => x.classList.remove('active'));
        b.classList.add('active');
        const trade = b.textContent.trim().toLowerCase();
        loadJobs({ trade: trade === 'all' ? '' : trade, offset: 0 });
      } else {
        b.classList.toggle('active');
      }
    }));
  });

  /* ===== LTN AI Search ===== */
  const input = document.getElementById('ai-search-input');
  const box   = document.getElementById('ai-results-container');

  function thinking(){ box.style.display='block'; box.innerHTML =
    `<div class="ai-thinking">
      <svg style="width:20px;height:20px" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
      </svg>
      <span>LTN AI is thinking</span>
      <div class="ai-thinking-dots"><span></span><span></span><span></span></div>
    </div>`; }

  function friendlyFallback(query, reason){
    box.style.display='block';
    box.innerHTML = `
      <div class="ai-result">
        <div class="ai-result-title">LTN AI is temporarily unavailable</div>
        <p class="small" style="color:var(--muted)">${reason}</p>
        <p>Here are some quick ideas related to "<b>${query.replace(/</g,'&lt;')}</b>":</p>
        <ul style="margin:0 0 8px 18px">
          <li>Check local licensing requirements and apprenticeship paths.</li>
          <li>Look up prevailing wages for your county and trade.</li>
          <li>Search for nearby union halls or training centers.</li>
        </ul>
        <p class="small" style="color:var(--muted)">Try again in a moment.</p>
      </div>`;
  }

  async function pingExec(){
    try{
      const r = await fetch(WEBAPP_URL, { method:'GET' });
      if (!r.ok) return { ok:false, code:r.status, html:isHtmlResponse(r) };
      if (isHtmlResponse(r)) return { ok:false, code:200, html:true };
      const j = await r.json().catch(()=>null);
      return { ok: !!j, code:r.status, html:false, body:j };
    }catch(e){
      return { ok:false, code:'NETWORK', html:false, error:String(e) };
    }
  }

  async function aiSearch(query){
    if (!query.trim()){ box.style.display='none'; return; }
    thinking();

    const ping = await pingExec();
    if (!ping.ok){
      const diag = ping.html
        ? "Your Apps Script Web App is not public. In Apps Script: Manage deployments → Web app → Who has access = Anyone. Use the /exec URL."
        : `The Web App is unreachable (status: ${ping.code}).`;
      friendlyFallback(query, diag);
      return;
    }

    const controller = new AbortController();
    const t = setTimeout(()=>controller.abort(), 15000);

    try{
      const email = localStorage.getItem('userEmail') || '';
      const res = await fetch(WEBAPP_URL, {
        method:'POST',
        headers:{ 'Content-Type':'text/plain;charset=utf-8' },
        body: JSON.stringify({ action:'ai-search', query, email }),
        signal: controller.signal
      });
      clearTimeout(t);

      const ct = res.headers.get('content-type') || '';
      if (ct.includes('text/html')){
        friendlyFallback(query, "Apps Script returned HTML (likely not public). Set access to Anyone and use the /exec URL.");
        return;
      }

      if (!res.ok){
        friendlyFallback(query, `Backend returned HTTP ${res.status}.`);
        return;
      }

      const data = await res.json();
      if (!data.success){
        friendlyFallback(query, data.error || "Unknown backend error.");
        return;
      }

      const ai = data.response || {};
      const title = ai.title || `Results for "${query}"`;
      const content = ai.content || 'No results found.';
      box.style.display='block';
      box.innerHTML = `<div class="ai-result"><div class="ai-result-title">${title}</div><p>${content}</p></div>`;

    }catch(err){
      clearTimeout(t);
      const msg = (err.name === 'AbortError') ? 'Request timed out.' : (err.message || 'Network error.');
      friendlyFallback(query, msg);
      console.error('AI search error:', err);
    }
  }

  const debounced = debounce(q=>aiSearch(q), 500);
  input.addEventListener('input', function(){ debounced(this.value); });
  input.addEventListener('focus', function(){ if (this.value.trim()) aiSearch(this.value); });
  input.addEventListener('keydown', e=>{ if (e.key==='Enter' && input.value.trim()) aiSearch(input.value); });
  input.addEventListener('keydown', e => { if (e.key === 'Escape') { box.style.display='none'; box.innerHTML=''; } });
  document.addEventListener('click', e=>{ if (!input.contains(e.target) && !box.contains(e.target)) box.style.display='none'; });

  window.storeUserEmail = function(email){
    if (email && typeof email === 'string') localStorage.setItem('userEmail', email);
  };

  /* ===== JOB SEARCH ===== */
  window.JOBS_STATE = { q:'', location:'', trade:'', limit:10, offset:0, total:0 };

  function renderJobs_(items){
    const list = document.getElementById('jobs-list');
    const empty = document.getElementById('jobs-empty');
    const prev = document.getElementById('jobs-prev');
    const next = document.getElementById('jobs-next');
    const count = document.getElementById('jobs-count');

    list.innerHTML = '';
    if (!items || !items.length){
      empty.style.display = 'block';
      prev.disabled = true; next.disabled = true;
      count.textContent = '';
      return;
    }
    empty.style.display = 'none';

    items.forEach(j => {
      const el = document.createElement('article');
      el.className = 'job';
      const when = j.postedAt ? new Date(j.postedAt) : null;
      el.innerHTML = `
        <div class="title">${j.title || 'Job'}</div>
        <div class="meta">
          <svg width="16" height="16" viewBox="0 0 24 24"><path d="M12 13c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3Z" stroke="currentColor"/><path d="M19 10c0 4.418-7 10-7 10S5 14.418 5 10a7 7 0 1 1 14 0Z" stroke="currentColor"/></svg>
          ${[j.city,j.state].filter(Boolean).join(', ')} <span class="meta-dot"></span> ${j.type || '—'} <span class="meta-dot"></span> ${j.pay || ''}
          ${when ? `<span class="meta-dot"></span> ${when.toLocaleDateString()}` : ''}
        </div>
        <div class="tags">
          ${(j.tradeTags||'').split(',').filter(Boolean).slice(0,4).map(t=>`<span class="tag">${t.trim()}</span>`).join('')}
        </div>
        <div class="apply">
          ${j.link ? `<a class="btn btn-primary" href="${j.link}" target="_blank" rel="noopener">Apply Now</a>` : `<button class="btn-primary" disabled>Apply</button>`}
          <button class="btn-secondary">Save</button>
        </div>
      `;
      list.appendChild(el);
    });

    const { offset, limit, total } = window.JOBS_STATE;
    const end = Math.min(offset + limit, total);
    prev.disabled = offset <= 0;
    next.disabled = end >= total;
    count.textContent = total ? `${offset + 1}–${end} of ${total}` : '';
  }

  async function loadJobs(opts={}){
    window.JOBS_STATE = { ...window.JOBS_STATE, ...opts };
    const { q, location, trade, limit, offset } = window.JOBS_STATE;

    try{
      const res = await fetch(WEBAPP_URL, {
        method:'POST',
        headers:{ 'Content-Type':'text/plain;charset=utf-8' },
        body: JSON.stringify({ action:'job-search', query:q, location, trade, limit, offset })
      });
      const data = await res.json();
      if (!data.success) throw new Error(data.error || 'Job search failed');

      window.JOBS_STATE.total = data.total || 0;
      renderJobs_(data.results || []);
    }catch(e){
      console.error('job-search error:', e);
      renderJobs_([]);
    }
  }

  document.getElementById('jobs-prev').addEventListener('click', ()=>{
    const { offset, limit } = window.JOBS_STATE;
    if (offset > 0) loadJobs({ offset: Math.max(0, offset - limit) });
  });
  document.getElementById('jobs-next').addEventListener('click', ()=>{
    const { offset, limit, total } = window.JOBS_STATE;
    if (offset + limit < total) loadJobs({ offset: offset + limit });
  });

  // Initial loads
  loadJobs();
  loadSponsors();
});
</script>

</body>
</html>
